kind: ConfigMap
apiVersion: v1
metadata:
  name: argocd-notifications-cm
data:
  service.webhook.test-webhook: |
    url: https://webhook/hooks/example
  template.test-app-deployed: |
    webhook:
      test-webhook:
        method: POST
        body: |
          {"deployed":"{{.app.metadata.name}}","status":"{{.app.status.operationState.phase}}","health":"{{.app.status.health.status}}"}
  trigger.test-app-deployed: |-
    - description: Application is synced and healthy. Triggered once per commit.
      oncePer: app.status.operationState.syncResult.revision
      send:
      - test-app-deployed
      when: app.status.operationState.phase in ['Succeeded'] and app.status.health.status == 'Healthy' 


